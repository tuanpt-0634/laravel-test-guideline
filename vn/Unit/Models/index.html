
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.6">
    
    
      
        <title>Testing Models - PHP Testing Guidelines</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6910b76c.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#testing-models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="PHP Testing Guidelines" class="md-header-nav__button md-logo" aria-label="PHP Testing Guidelines">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            PHP Testing Guidelines
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Testing Models
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="PHP Testing Guidelines" class="md-nav__button md-logo" aria-label="PHP Testing Guidelines">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    PHP Testing Guidelines
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." class="md-nav__link">
      Giới thiệu
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../01-why/" class="md-nav__link">
      Viết test để làm gì?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../02-testcase/" class="md-nav__link">
      Cơ bản về test case
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../03-phpunit/" class="md-nav__link">
      PHPUnit
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../04-code-coverage/" class="md-nav__link">
      Code Coverage
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../05-test-doubles-and-di/" class="md-nav__link">
      Test Doubles và DI
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../06-mutation-testing/" class="md-nav__link">
      Mutation Testing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../07-laravel/" class="md-nav__link">
      Laravel
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../08-checklist/" class="md-nav__link">
      Checklist
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../09-references/" class="md-nav__link">
      Tài liệu khác
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" >
    <label class="md-nav__link" for="nav-11">
      En
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="En" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon"></span>
        En
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../en/Conventions/" class="md-nav__link">
      Laravel Testing Conventions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../en/Introduction/" class="md-nav__link">
      Introduction to Laravel Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../en/Knowledge/" class="md-nav__link">
      Knowledge about Unit Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11-4" type="checkbox" id="nav-11-4" >
    <label class="md-nav__link" for="nav-11-4">
      Integration
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Integration" data-md-level="2">
      <label class="md-nav__title" for="nav-11-4">
        <span class="md-nav__icon md-icon"></span>
        Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../en/Integration/Integration/" class="md-nav__link">
      Integration Tests
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11-5" type="checkbox" id="nav-11-5" >
    <label class="md-nav__link" for="nav-11-5">
      Unit
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Unit" data-md-level="2">
      <label class="md-nav__title" for="nav-11-5">
        <span class="md-nav__icon md-icon"></span>
        Unit
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../en/Unit/Common/" class="md-nav__link">
      Common Testing Rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../en/Unit/Controllers/" class="md-nav__link">
      Testing Controllers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../en/Unit/Middleware/" class="md-nav__link">
      Testing Middleware Classes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../en/Unit/Models/" class="md-nav__link">
      Testing Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../en/Unit/Transformers/" class="md-nav__link">
      Testing Transformers and Presenters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../en/Unit/Validation/" class="md-nav__link">
      Testing Validation Rules.
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12" checked>
    <label class="md-nav__link" for="nav-12">
      Vn
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Vn" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        <span class="md-nav__icon md-icon"></span>
        Vn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Conventions/" class="md-nav__link">
      Laravel Testing Conventions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Introduction/" class="md-nav__link">
      Giới thiệu về Laravel Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Knowledge/" class="md-nav__link">
      Knowledge about Unit Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12-4" type="checkbox" id="nav-12-4" >
    <label class="md-nav__link" for="nav-12-4">
      Integration
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Integration" data-md-level="2">
      <label class="md-nav__title" for="nav-12-4">
        <span class="md-nav__icon md-icon"></span>
        Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Integration/Integration/" class="md-nav__link">
      Integration Tests
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12-5" type="checkbox" id="nav-12-5" checked>
    <label class="md-nav__link" for="nav-12-5">
      Unit
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Unit" data-md-level="2">
      <label class="md-nav__title" for="nav-12-5">
        <span class="md-nav__icon md-icon"></span>
        Unit
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Common/" class="md-nav__link">
      Common Testing Rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Controllers/" class="md-nav__link">
      Testing Controllers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Middleware/" class="md-nav__link">
      Testing Middleware Classes
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Testing Models
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Testing Models
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#guide" class="md-nav__link">
    Guide
  </a>
  
    <nav class="md-nav" aria-label="Guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-properties" class="md-nav__link">
    Configuration properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relations" class="md-nav__link">
    Relations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property-values" class="md-nav__link">
    Property values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-checks" class="md-nav__link">
    Additional checks.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Transformers/" class="md-nav__link">
      Testing Transformers and Presenters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Validation/" class="md-nav__link">
      Testing Validation Rules.
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#guide" class="md-nav__link">
    Guide
  </a>
  
    <nav class="md-nav" aria-label="Guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-properties" class="md-nav__link">
    Configuration properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relations" class="md-nav__link">
    Relations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property-values" class="md-nav__link">
    Property values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-checks" class="md-nav__link">
    Additional checks.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="testing-models">Testing Models<a class="headerlink" href="#testing-models" title="Permanent link">&para;</a></h1>
<p>Models là một trong những class được sử dụng nhiều nhất trong Laravel Application. Cùng với đó, chúng là thành phần phức tạp nhất trong số các default components.</p>
<p>Tuỳ vào cách bạn thực hiện, mà models có thể bao gồm validation, external services connection (e. g. ElasticSearch indexing), hay property getters và nhiều custom methods khác.</p>
<p>Do models được sử dụng ở khắp nơi trong application, nên chúng phải được test một cách cẩn thận.</p>
<h2 id="guide">Guide<a class="headerlink" href="#guide" title="Permanent link">&para;</a></h2>
<h3 id="configuration-properties">Configuration properties<a class="headerlink" href="#configuration-properties" title="Permanent link">&para;</a></h3>
<p>Mọi Model đều bao gồm một vài các thiết lập cơ bản với các public hoặc protected properties. Những properties này có thể ảnh hưởng rất nhiều đến cách thức hoạt động của application, tuy nhiên chúng là là những thành phần dễ test nhất.</p>
<p>Bạn có thể assert giá trị trả về của property getters:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%; margin: 0;"><span></span><code><span style="color: #2838b0">public</span> <span style="color: #2838b0">function</span> <span style="color: #785840">test_contains_valid_fillable_properties</span><span style="color: #888888">()</span>
<span style="color: #888888">{</span>
    <span style="color: #b04040">$m</span> <span style="color: #666666">=</span> <span style="color: #2838b0">new</span> User<span style="color: #888888">();</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertEquals</span><span style="color: #888888">([</span><span style="color: #b83838">&#39;name&#39;</span><span style="color: #888888">,</span> <span style="color: #b83838">&#39;email&#39;</span><span style="color: #888888">],</span> <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">getFillable</span><span style="color: #888888">());</span>
<span style="color: #888888">}</span>
</code></pre></div>
<p>Những method tests sau cần phải được sử dụng trong quá trình tests:</p>
<ul>
<li><code>$fillable</code> -&gt; <code>getFillable()</code></li>
<li><code>$guarded</code> -&gt; <code>getGuarded()</code></li>
<li><code>$table</code> -&gt; <code>getTable()</code></li>
<li><code>$primaryKey</code> -&gt; <code>getKeyName()</code></li>
<li><code>$connection</code> -&gt; <code>getConnectionName()</code>: Trong trường hợp bạn sử dụng multiple connections.</li>
<li><code>$hidden</code> -&gt; <code>getHidden()</code></li>
<li><code>$visible</code> -&gt; <code>getVisible()</code></li>
<li><code>$casts</code> -&gt; <code>getCasts()</code>: note that method appends incrementing key.</li>
<li><code>$dates</code> -&gt; <code>getDates()</code>: note that method appends <code>[static::CREATED_AT, static::UPDATED_AT]</code>.</li>
<li><code>newCollection()</code>: kiểm tra collection có đúng kiểu dữ liệu hay không. Sử dụng <code>assertEquals</code> với kết quả trả về từ hàm <code>get_class()</code>, chứ không dùng <code>assertInstanceOf</code>.</li>
</ul>
<p>Chúng ta có thể đặt hết tất cả những kiểm tra trên bên trong một test method, chẳng hạn như <code>test_model_configuration()</code></p>
<h3 id="relations">Relations<a class="headerlink" href="#relations" title="Permanent link">&para;</a></h3>
<p>Relations được định nghĩa là các methods trả về class relation tương ứng. Trong nhiều trường hợp, relation có thể được định nghĩa với custom foreign keys, hoặc với những câu query thêm vào. Cách tốt nhất để test relation config là assert instance <code>Relation</code> được trả về.</p>
<p>Trong tất cả các trường hợp bình thường, các relations được tạo ra với <code>$model-&gt;newQuery()</code> như là builder instance. Nếu không được chỉnh sửa gì, nó có thể được kiểm tra một cách đơn giản với <code>assertEquals</code></p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%; margin: 0;"><span></span><code><span style="color: #2838b0">public</span> <span style="color: #2838b0">function</span> <span style="color: #785840">test_user_relation</span><span style="color: #888888">()</span>
<span style="color: #888888">{</span>
    <span style="color: #b04040">$m</span> <span style="color: #666666">=</span> <span style="color: #2838b0">new</span> Post<span style="color: #888888">();</span>
    <span style="color: #b04040">$relation</span> <span style="color: #666666">=</span> <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">user</span><span style="color: #888888">();</span>

    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertInstanceOf</span><span style="color: #888888">(</span>BelongsTo<span style="color: #666666">::</span><span style="color: #388038">class</span><span style="color: #888888">,</span> <span style="color: #b04040">$relation</span><span style="color: #888888">);</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertEquals</span><span style="color: #888888">(</span><span style="color: #b83838">&#39;user_id&#39;</span><span style="color: #888888">,</span> <span style="color: #b04040">$relation</span><span style="color: #666666">-&gt;</span><span style="color: #388038">getForeignKey</span><span style="color: #888888">());</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertEquals</span><span style="color: #888888">(</span><span style="color: #b83838">&#39;id&#39;</span><span style="color: #888888">,</span> <span style="color: #b04040">$relation</span><span style="color: #666666">-&gt;</span><span style="color: #388038">getOwnerKey</span><span style="color: #888888">());</span>
    <span style="color: #888888; font-style: italic">//...</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertEquals</span><span style="color: #888888">(</span><span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">newQuery</span><span style="color: #888888">(),</span> <span style="color: #b04040">$relation</span><span style="color: #666666">-&gt;</span><span style="color: #388038">getQuery</span><span style="color: #888888">());</span>
<span style="color: #888888">}</span>
</code></pre></div>
<p>Tuỳ theo loại quan hệ, mà các test assertion sau cần phải được sử dụng:</p>
<ul>
<li><code>getQuery()</code>: kiểm tra query chưa được chỉnh sửa, hoặc đã được chỉnh sửa một cách chính xác.</li>
<li><code>getForeignKey()</code>: với những quan hệ <code>HasOneOrMany</code> hoặc <code>BelongsTo</code>, nhưng loại key thì khác nhau (see documentaiton).</li>
<li><code>getQualifiedParentKeyName()</code>: với quan hệ <code>HasOneOrMany</code>, do không có <code>getLocalKey()</code> method, nên method này cần được kiểm tra.</li>
<li><code>getOwnerKey()</code>: với quan hệ <code>BelongsTo</code> và những quan hệ mở rộng từ nó.</li>
<li><code>getQualifiedForeignPivotKeyName()</code>: với quan hệ <code>BelongsToMany</code>.</li>
<li><code>getQualifiedRelatedPivotKeyName()</code>: với quan hệ <code>BelongsToMany</code>.</li>
<li><code>getTable()</code>: với quan hệ <code>BelongsToMany</code>. Không bắt buộc, bởi nó được bao gồm trong những method ở trên.</li>
<li><code>getMorphType()</code>: với quan hệ polymorphic.</li>
</ul>
<h3 id="property-values">Property values<a class="headerlink" href="#property-values" title="Permanent link">&para;</a></h3>
<p>Rất nhiều models có thể bao gồm property mutators hay getters. Những methods này thực hiện tay đổi output trong rất nhiều trường hợp, bao gồm cả kết quả từ <code>__get</code> và <code>toArray()</code>.</p>
<p>Cần phải có những test cases thực hiện assertion trên tất cả các properties.</p>
<p>Trong trường hợp này, bạn cần sử dụng <code>unguarded</code> helper hoặc tự loại bỏ guards.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%; margin: 0;"><span></span><code><span style="color: #2838b0">public</span> <span style="color: #2838b0">function</span> <span style="color: #785840">test_properties_have_valid_values</span><span style="color: #888888">()</span>
<span style="color: #888888">{</span>
    User<span style="color: #666666">::</span><span style="color: #388038">unguard</span><span style="color: #888888">();</span>

    <span style="color: #b04040">$initial</span> <span style="color: #666666">=</span> <span style="color: #888888">[</span>
        <span style="color: #b83838">&#39;name&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #b83838">&#39;Jonh Doe&#39;</span><span style="color: #888888">,</span>
        <span style="color: #b83838">&#39;email&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #b83838">&#39;jonh@example.com&#39;</span><span style="color: #888888">,</span>
    <span style="color: #888888">];</span>

    <span style="color: #b04040">$m</span> <span style="color: #666666">=</span> <span style="color: #2838b0">new</span> User<span style="color: #888888">(</span><span style="color: #b04040">$initial</span><span style="color: #888888">);</span>

    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertEquals</span><span style="color: #888888">(</span><span style="color: #b04040">$initial</span><span style="color: #888888">,</span> <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">setHidden</span><span style="color: #888888">([]),</span> <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">attributesToArray</span><span style="color: #888888">());</span>
<span style="color: #888888">}</span>
</code></pre></div>
<p>Trong trường hợp có những getter, thì giá trị trả ra có thể bị thay đổi, bởi vậy tests cần cover các trường hợp này.</p>
<p>Sử dụng <code>getAttributeValue()</code> để chắc chắn rằng getter đã được gọi. Sau đó gọi đến getter để test giá trị trả ra là khác nhau.</p>
<p>Trong trường hợp có cả mutators, sử dụng <code>setRawAttributes</code> để set giá trị ban đầu mà không gặp phải những sự thay đổi không lường trước được trên giá trị đó.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%; margin: 0;"><span></span><code><span style="color: #2838b0">public</span> <span style="color: #2838b0">function</span> <span style="color: #785840">test_status_getter</span><span style="color: #888888">()</span>
<span style="color: #888888">{</span>
    <span style="color: #b04040">$m</span> <span style="color: #666666">=</span> <span style="color: #2838b0">new</span> User<span style="color: #888888">();</span>
    <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">setRawAttributes</span><span style="color: #888888">([</span>
        <span style="color: #b83838">&#39;status&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #444444">1</span><span style="color: #888888">,</span>
    <span style="color: #888888">]);</span>

    <span style="color: #888888; font-style: italic">// Test if getter is working.</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertEquals</span><span style="color: #888888">(</span><span style="color: #b83838">&#39;enabled&#39;</span><span style="color: #888888">,</span> <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">getAttributeValue</span><span style="color: #888888">(</span><span style="color: #b83838">&#39;status&#39;</span><span style="color: #888888">));</span>

    <span style="color: #888888; font-style: italic">// Test getter logic with different values.</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertEquals</span><span style="color: #888888">(</span><span style="color: #b83838">&#39;disabled&#39;</span><span style="color: #888888">,</span> <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">getStatusAttribute</span><span style="color: #888888">(</span><span style="color: #444444">2</span><span style="color: #888888">));</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertEquals</span><span style="color: #888888">(</span><span style="color: #b83838">&#39;pending&#39;</span><span style="color: #888888">,</span> <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">getStatusAttribute</span><span style="color: #888888">(</span><span style="color: #444444">3</span><span style="color: #888888">));</span>

    <span style="color: #888888; font-style: italic">// Abnormal case</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">expectException</span><span style="color: #888888">(</span>\InvalidArgumentException<span style="color: #666666">::</span><span style="color: #388038">class</span><span style="color: #888888">);</span>
    <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">getStatusAttribute</span><span style="color: #888888">(</span><span style="color: #444444">4</span><span style="color: #888888">);</span>
<span style="color: #888888">}</span>
</code></pre></div>
<p>Những quy tắc như vậy cũng được apply cho Mutators. Để tránh các getters được thực hiện, sử dụng method <code>getAttributes()</code> cho các assertions.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%; margin: 0;"><span></span><code><span style="color: #2838b0">public</span> <span style="color: #2838b0">function</span> <span style="color: #785840">test_status_getter</span><span style="color: #888888">()</span>
<span style="color: #888888">{</span>
    <span style="color: #b04040">$m</span> <span style="color: #666666">=</span> <span style="color: #2838b0">new</span> User<span style="color: #888888">();</span>

    <span style="color: #888888; font-style: italic">// Test if mutator is working.</span>
    <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">setAttribute</span><span style="color: #888888">(</span><span style="color: #b83838">&#39;status&#39;</span><span style="color: #888888">,</span> <span style="color: #b83838">&#39;enabled&#39;</span><span style="color: #888888">);</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertEquals</span><span style="color: #888888">(</span><span style="color: #444444">1</span><span style="color: #888888">,</span> <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">getAttributes</span><span style="color: #888888">()[</span><span style="color: #b83838">&#39;status&#39;</span><span style="color: #888888">]);</span>

    <span style="color: #888888; font-style: italic">// Test mutator logic with different values.</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertEquals</span><span style="color: #888888">(</span><span style="color: #444444">2</span><span style="color: #888888">,</span> <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">setStatusAttribute</span><span style="color: #888888">(</span><span style="color: #b83838">&#39;disabled&#39;</span><span style="color: #888888">);</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">assertEquals</span><span style="color: #888888">(</span><span style="color: #444444">3</span><span style="color: #888888">,</span> <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">setStatusAttribute</span><span style="color: #888888">(</span><span style="color: #b83838">&#39;pending&#39;</span><span style="color: #888888">);</span>

    <span style="color: #888888; font-style: italic">// Abnormal case</span>
    <span style="color: #b04040">$this</span><span style="color: #666666">-&gt;</span><span style="color: #388038">expectException</span><span style="color: #888888">(</span>\InvalidArgumentException<span style="color: #666666">::</span><span style="color: #388038">class</span><span style="color: #888888">);</span>
    <span style="color: #b04040">$m</span><span style="color: #666666">-&gt;</span><span style="color: #388038">setStatusAttribute</span><span style="color: #888888">(</span><span style="color: #b83838">&#39;invalid_status&#39;</span><span style="color: #888888">);</span>
<span style="color: #888888">}</span>
</code></pre></div>
<h3 id="events">Events<a class="headerlink" href="#events" title="Permanent link">&para;</a></h3>
<p>Model bao gồm protected static <code>$dispatcher</code> property, thứ có chứa application event handler. Nếu model của bạn sử dụng internal events hay observers, hãy chắc chắn rằng listeners tương ứng được assign thông qua class dispather được mock.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%; margin: 0;"><span></span><code><span style="color: #2838b0">public</span> <span style="color: #2838b0">function</span> <span style="color: #785840">test_listeners_attached</span><span style="color: #888888">()</span>
<span style="color: #888888">{</span>
    <span style="color: #b04040">$d</span> <span style="color: #666666">=</span> m<span style="color: #666666">::</span><span style="color: #388038">mock</span><span style="color: #888888">(</span>\Illuminate\Contracts\Events\Dispatcher<span style="color: #666666">::</span><span style="color: #388038">class</span><span style="color: #888888">);</span>
    User<span style="color: #666666">::</span><span style="color: #388038">setEventDispatcher</span><span style="color: #888888">(</span><span style="color: #b04040">$d</span><span style="color: #888888">);</span>
    <span style="color: #b04040">$name</span> <span style="color: #666666">=</span> User<span style="color: #666666">::</span><span style="color: #388038">class</span><span style="color: #888888">;</span>

    <span style="color: #888888; font-style: italic">// Assert that created event has been assigned. Include additional checks if needed.</span>
    <span style="color: #b04040">$d</span><span style="color: #666666">-&gt;</span><span style="color: #388038">shouldReceive</span><span style="color: #888888">(</span><span style="color: #b83838">&#39;listen&#39;</span><span style="color: #888888">)</span><span style="color: #666666">-&gt;</span><span style="color: #388038">once</span><span style="color: #888888">()</span><span style="color: #666666">-&gt;</span><span style="color: #388038">with</span><span style="color: #888888">(</span><span style="color: #b83838">&quot;eloquent.created: </span><span style="color: #b83838; text-decoration: underline">{</span><span style="color: #b04040">$name</span><span style="color: #b83838; text-decoration: underline">}</span><span style="color: #b83838">&quot;</span><span style="color: #888888">,</span> m<span style="color: #666666">::</span><span style="color: #388038">any</span><span style="color: #888888">());</span>

    User<span style="color: #666666">::</span><span style="color: #388038">boot</span><span style="color: #888888">();</span>
<span style="color: #888888">}</span>
</code></pre></div>
<blockquote>
<p>Không sử dụng <code>Dispather::hasListeners()</code> method, bởi event có thể được assign từ bất kỳ đâu trong application.
Mục đích của test này là để đảm bảo rằng events được assign từ bên trong Model.</p>
</blockquote>
<p>Testing với observers nên tuân theo những cách thức tiếp cận chung giống với testing cho các class thông thường khác.</p>
<p>Event handlers được attach trong quá trình boot có thể được truy cập thông qua <code>getListeners()</code> method của event dispatcher.
Tuy nhiên hoàn toàn không nên sử dụng assignments kiểu như vậy, mà thay vào đó nên dùng observers.</p>
<h3 id="additional-checks">Additional checks.<a class="headerlink" href="#additional-checks" title="Permanent link">&para;</a></h3>
<p>Tất cả các method hay các configuration khác đều phải được test. Chúng bao gồm (không phải là toàn bộ):</p>
<ul>
<li>Custom model methods.</li>
<li>Sử dụng Traits.</li>
<li>Custom <code>CREATED_AT</code> và <code>UPDATED_AT</code> keys.</li>
<li><code>$with</code> property nếu có.</li>
<li><code>$incrementing</code> property nếu được thay đổi so với mặc định.</li>
<li><code>$dateFormat</code> property nếu được thay đổi so với mặc định.</li>
</ul>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/framgia/laravel-test-examples/blob/master/tests/ModelTestCase.php">Example abstract model test helper</a></li>
<li><a href="https://github.com/framgia/laravel-test-examples/blob/master/app/City.php">Example model</a> and <a href="https://github.com/framgia/laravel-test-examples/blob/master/tests/Unit/CityTest.php">test</a></li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../Middleware/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Testing Middleware Classes
              </div>
            </div>
          </a>
        
        
          <a href="../Transformers/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Testing Transformers and Presenters
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../../../assets/javascripts/bundle.7836ba4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>